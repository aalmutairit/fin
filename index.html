<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حساب المقابل المالي</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }
        label {
            font-size: 16px;
            margin-bottom: 10px;
            display: block;
        }
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            background-color: #f1f1f1;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .result p {
            font-size: 18px;
            margin: 5px 0;
        }
        .hidden {
            display: none;
        }
        .subActivityField {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="logo">
        <img src="static/logo.png" alt="الشعار" width="300">
    </div>

    <h1>حساب المقابل المالي</h1>

    <form id="costForm">
        <label for="activity">اختر النشاط:</label>
        <select id="activity" name="activity" onchange="updateFields()">
            <option value="none">اختر النشاط</option>
            <option value="wasteTreatment">معالجة النفايات</option>
            <option value="nonHazardousWasteCollection">جمع ونقل النفايات غير الخطرة</option>
            <option value="hazardousWasteCollection">جمع ونقل النفايات الخطرة</option>
        </select>

        <!-- الأنشطة الفرعية لمعالجة النفايات -->
        <div id="wasteTreatmentSubActivities" class="hidden">
            <label for="subActivityTreatment">اختر الأنشطة الفرعية:</label>
            <select id="subActivityTreatment" name="subActivityTreatment" onchange="toggleVehicleFields('treatment')">
                <option value="hazardousWaste">معالجة النفايات الخطرة</option>
                <option value="healthcareWaste">معالجة نفايات الرعاية الصحية الخطرة</option>
                <option value="asbestosWaste">تفكيك وتغليف نفايات الأسبستوس</option>
            </select>
        </div>

        <!-- الأنشطة الفرعية لجمع ونقل النفايات غير الخطرة -->
        <div id="nonHazardousSubActivities" class="hidden">
            <label for="subActivityNonHazardous">اختر الأنشطة الفرعية:</label>
            <select id="subActivityNonHazardous" name="subActivityNonHazardous" multiple onchange="toggleVehicleFields('nonHazardous')">
                <option value="residential">جمع ونقل نفايات المنازل</option>
                <option value="commercial">جمع ونقل نفايات تجارية وإدارية</option>
                <option value="marine">جمع ونقل نفايات بحرية</option>
                <option value="green">جمع ونقل نفايات خضراء</option>
                <option value="recyclable">جمع ونقل نفايات قابلة لإعادة التدوير</option>
                <option value="construction">جمع ونقل نفايات الهدم والبناء</option>
                <option value="inert">جمع ونقل نفايات خاملة</option>
            </select>
        </div>

        <!-- الأنشطة الفرعية لجمع ونقل النفايات الخطرة -->
        <div id="hazardousSubActivities" class="hidden">
            <label for="subActivityHazardous">اختر الأنشطة الفرعية:</label>
            <select id="subActivityHazardous" name="subActivityHazardous" multiple onchange="toggleVehicleFields('hazardous')">
                <option value="chemical">جمع ونقل نفايات كيميائية</option>
                <option value="medical">جمع ونقل نفايات طبية</option>
                <option value="sludge">جمع ونقل الحمأة</option>
                <option value="oil">جمع ونقل نفايات الزيوت</option>
                <option value="asbestos">جمع ونقل نفايات الأسبستوس</option>
                <option value="electronic">جمع ونقل نفايات إلكترونية وكهربائية</option>
                <option value="battery">جمع ونقل نفايات البطاريات</option>
                <option value="carbon">جمع ونقل الرماد الكربوني</option>
                <option value="marineHazardous">جمع ونقل نفايات بحرية خطرة</option>
            </select>
        </div>

        <!-- حقل السعة التشغيلية القصوى للنفايات -->
        <div id="capacityDiv" class="hidden">
            <label for="capacity">السعة القصوى للمعالجة (طن/يوم):</label>
            <input type="number" id="capacity" name="capacity" required placeholder="أدخل السعة القصوى للمعالجة" />
        </div>

        <!-- حقل عدد المركبات لكل نشاط فرعي -->
        <div id="vehicleFields"></div>

        <button type="button" onclick="calculateCost()">حساب التكلفة</button>
    </form>

    <div class="result" id="result" style="display:none;">
        <p>التكلفة الإجمالية: <span id="totalCost"></span> ريال</p>
    </div>
</div>

<script>
    function updateFields() {
        const activity = document.getElementById("activity").value;
        const wasteTreatmentSubActivities = document.getElementById("wasteTreatmentSubActivities");
        const nonHazardousSubActivities = document.getElementById("nonHazardousSubActivities");
        const hazardousSubActivities = document.getElementById("hazardousSubActivities");
        const capacityDiv = document.getElementById("capacityDiv");

        wasteTreatmentSubActivities.classList.add("hidden");
        nonHazardousSubActivities.classList.add("hidden");
        hazardousSubActivities.classList.add("hidden");
        capacityDiv.classList.add("hidden");
        document.getElementById("vehicleFields").innerHTML = '';

        if (activity === "wasteTreatment") {
            wasteTreatmentSubActivities.classList.remove("hidden");
        } else if (activity === "nonHazardousWasteCollection") {
            nonHazardousSubActivities.classList.remove("hidden");
        } else if (activity === "hazardousWasteCollection") {
            hazardousSubActivities.classList.remove("hidden");
        }
    }

    function toggleVehicleFields(activityType) {
        const selectedOptions = document.querySelectorAll(`#subActivity${capitalizeFirstLetter(activityType)} option:checked`);
        const vehicleFields = document.getElementById("vehicleFields");
        let fieldsHTML = "";

        selectedOptions.forEach(option => {
            fieldsHTML += `<label for="vehicles_${option.value}">عدد المركبات لـ ${option.text}:</label>
                            <input type="number" id="vehicles_${option.value}" name="vehicles_${option.value}" required min="1" placeholder="أدخل عدد المركبات لـ ${option.text}" />`;
        });

        vehicleFields.innerHTML = fieldsHTML;
    }

    function calculateCost() {
        const activity = document.getElementById("activity").value;
        let totalCost = 0;
        let highestCostFactor = 0;

        if (activity === "wasteTreatment") {
            const capacity = parseFloat(document.getElementById("capacity").value);
            if (!isNaN(capacity)) {
                totalCost += calculateTreatmentCost(capacity);
                highestCostFactor = Math.max(highestCostFactor, getCostFactorForCapacity(capacity));
            }
        } else {
            const vehicleFields = document.querySelectorAll("#vehicleFields input");
            vehicleFields.forEach(field => {
                const numVehicles = parseInt(field.value);
                if (numVehicles && !isNaN(numVehicles)) {
                    totalCost += calculateCollectionCost(field.name, numVehicles);
                    highestCostFactor = Math.max(highestCostFactor, getCostFactorForVehicles(numVehicles));
                }
            });
        }

        // إضافة المقابل المالي لتدقيق الطلب بناءً على أعلى معامل تكلفة
        const inspectionFee = getInspectionFee(highestCostFactor);
        totalCost += inspectionFee;

        document.getElementById("totalCost").innerText = totalCost;
        document.getElementById("result").style.display = "block";
    }

    function calculateTreatmentCost(capacity) {
        let baseCost;
        if (capacity < 1) {
            baseCost = 10000; // تفكيك وتغليف الأسبستوس
        } else if (capacity <= 10) {
            baseCost = 30000; // معالجة النفايات الخطرة أو الرعاية الصحية
        } else {
            baseCost = 30000; // معالجة النفايات الخطرة أو الرعاية الصحية
        }

        let factor = (capacity < 1) ? 0.8 : (capacity <= 10) ? 1.0 : 1.2;
        return baseCost * factor;
    }

    function calculateCollectionCost(activity, numVehicles) {
        let baseCost = 7500; // خط الأساس للنفايات
        let factor = (numVehicles < 10) ? 0.8 : (numVehicles <= 50) ? 1.0 : 1.2;
        return baseCost * factor;
    }

    function getCostFactorForCapacity(capacity) {
        if (capacity < 1) return 0.8;
        else if (capacity <= 10) return 1.0;
        else return 1.2;
    }

    function getCostFactorForVehicles(numVehicles) {
        if (numVehicles < 10) return 0.8;
        else if (numVehicles <= 50) return 1.0;
        else return 1.2;
    }

    function getInspectionFee(factor) {
        if (factor === 0.8) return 1000; // منخفض
        return 3000; // متوسط أو مرتفع
    }

    function capitalizeFirstLetter(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }
</script>

</body>
</html>
